---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";
import Hero from "../components/Hero.astro";
import About from "../components/About.astro";
import Skills from "../components/Skills.astro";
import Projects from "../components/Projects.astro";
import Contact from "../components/Contact.astro";
import Footer from "../components/Footer.astro";

const projects = [
  {
    name: "SeeJTI",
    desc: "A web application for viewing class schedules in the Information Technology department at Politeknik Negeri Malang.",
    img: "/images/SeeJTI.png",
    url: "https://github.com/ForagiFox/SeeJTI",
  },
  {
    name: "SiLapor",
    desc: "A web application for reporting facility damage in the Information Technology department at Politeknik Negeri Malang.",
    img: "/images/Silapor.jpg",
    url: "https://github.com/User-425/SiLapor",
  },
  {
    name: "Portfolio",
    desc: "A personal portfolio project showcasing my work and skills.",
    img: "/images/Portofolio.png",
    url: "https://github.com/AuroraSauces/Portofolio_Dashboard",
  },
  {
    name: "Invitation Automation",
    desc: "A project designed to streamline the process of creating digital invitations.",
    img: "/images/OtoUn.png",
    url: "https://github.com/AuroraSauces/otomasi_undangan",
  },
];
---

<Layout title="Portfolio - Satria Wiguna">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />

  <Navigation />
  <Hero />
  <About />
  <Skills />
  <Projects projects={projects} />
  <Contact />
  <Footer />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navItems = Array.from(document.querySelectorAll('.nav-item'));
    const sections = Array.from(document.querySelectorAll('section[id]'));
    const heroSection = document.getElementById('hero');
    const aboutSection = document.getElementById('about');

    const setActive = (sectionId) => {
      navItems.forEach((item) => {
        item.classList.toggle('active', item.getAttribute('data-section') === sectionId);
      });
    };

    document.querySelectorAll('[data-scroll]').forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = button.getAttribute('data-scroll');
        if (!targetId) {
          return;
        }
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          setActive(targetId);
        }
      });
    });

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          setActive(entry.target.id);
        }
      });
    }, {
      root: null,
      rootMargin: '-45% 0px -45% 0px',
      threshold: 0
    });

    sections.forEach(section => observer.observe(section));
    setActive('hero');

    // Hero snap-to-about behavior
    let heroSnapPending = false;

    const isHeroInView = () => {
      if (!heroSection) return false;
      const rect = heroSection.getBoundingClientRect();
      return rect.top <= 30 && rect.bottom > window.innerHeight * 0.4;
    };

    const snapToAbout = () => {
      if (!aboutSection || heroSnapPending) return;
      heroSnapPending = true;
      aboutSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      setTimeout(() => {
        heroSnapPending = false;
      }, 600);
    };

    window.addEventListener('wheel', (event) => {
      if (event.deltaY <= 0 || !isHeroInView()) {
        return;
      }
      event.preventDefault();
      snapToAbout();
    }, { passive: false });

    let touchStartY = 0;
    window.addEventListener('touchstart', (event) => {
      touchStartY = event.touches[0]?.clientY || 0;
    }, { passive: true });

    window.addEventListener('touchmove', (event) => {
      if (!isHeroInView()) {
        return;
      }
      const currentY = event.touches[0]?.clientY || 0;
      if (touchStartY - currentY > 10) {
        event.preventDefault();
        snapToAbout();
      }
    }, { passive: false });

    const particlesContainer = document.getElementById('particles-container');
    const particleCount = 15;
    const isHighPerformance = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    if (isHighPerformance && particlesContainer) {
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 4 + 1;
        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        const duration = Math.random() * 20 + 15;
        const delay = Math.random() * 5;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${startX}%`;
        particle.style.top = `${startY}%`;
        particle.style.animationDuration = `${duration}s`;
        particle.style.animationDelay = `${delay}s`;
        
        particlesContainer.appendChild(particle);
      }
    }
  });
</script>

<style>
  html {
    scroll-behavior: smooth;
  }

  h1 {
    line-height: 1.3 !important;
    padding-top: 0.75rem !important;
    padding-bottom: 0.75rem !important;
    overflow: visible !important;
  }
</style>
